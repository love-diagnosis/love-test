<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>äº²å¯†å…³ç³»æ·±åº¦æ‰«æ Â· çµé­‚ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ============ è§†è§‰ç³»ç»Ÿï¼šV4.2 æœ€ç»ˆä¼˜åŒ–ç‰ˆ ============ */
        :root {
            --primary: #ff4757; 
            --accent: #ff6b81;
            --dark: #2f3542;
            --text-main: #2d3436;
            --text-sub: #636e72;
            --bg-gradient: linear-gradient(135deg, #fff0f0 0%, #ffe9e9 100%);
            --card-shadow: 0 8px 25px rgba(255, 71, 87, 0.15);
        }

        body {
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            background-image: var(--bg-gradient);
            margin: 0; padding: 0; color: var(--text-main);
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            width: 100%; max-width: 420px;
            background: #ffffff; min-height: 100vh;
            padding: 25px; box-sizing: border-box;
            box-shadow: 0 0 50px rgba(0,0,0,0.05);
            overflow-y: auto; position: relative;
        }

        /* é€šç”¨ç»„ä»¶ */
        .hidden { display: none !important; }
        .btn {
            display: block; width: 100%; padding: 16px;
            background: var(--primary); color: white; border: none;
            border-radius: 30px; font-size: 18px; font-weight: bold;
            cursor: pointer; margin-top: 30px;
            box-shadow: 0 6px 20px rgba(255, 71, 87, 0.3);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.96); }

        /* 1. é¦–é¡µ */
        #landing-page { text-align: center; padding-top: 60px; }
        .logo-emoji { font-size: 72px; margin-bottom: 10px; animation: heartbeat 2s infinite; }
        @keyframes heartbeat { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        h1 { font-size: 26px; color: var(--text-main); margin-bottom: 5px; letter-spacing: 1px; }
        .sub-title { color: var(--text-sub); font-size: 14px; margin-bottom: 50px; opacity: 0.8; }
        .login-box { 
            text-align: left; background: #fff; padding: 25px; 
            border-radius: 20px; box-shadow: var(--card-shadow); border: 1px solid #fff0f0;
        }
        .input-box { 
            width: 100%; padding: 16px; border: 2px solid #f1f2f6; 
            border-radius: 12px; font-size: 16px; box-sizing: border-box; 
            outline: none; background: #fafafa; transition: all 0.3s;
        }
        .input-box:focus { border-color: var(--primary); background: #fff; }

        /* 2. ç­”é¢˜é¡µ */
        #quiz-page { padding-top: 10px; }
        .progress-bar { height: 6px; background: #f1f2f6; border-radius: 3px; margin-bottom: 30px; overflow: hidden; }
        .progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
        
        .q-tag { 
            display: inline-block; background: #ffeaa7; color: #d35400; 
            padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: bold; margin-bottom: 15px;
        }
        .q-text { font-size: 20px; font-weight: 700; line-height: 1.5; margin-bottom: 30px; color: #2d3436; }
        
        .option-card {
            background: #fff; border: 2px solid #f5f6fa; padding: 18px; border-radius: 16px;
            margin-bottom: 15px; cursor: pointer; display: flex; align-items: center; 
            transition: all 0.2s; position: relative; overflow: hidden;
        }
        .option-card:active { border-color: var(--primary); background: #fff5f6; transform: scale(0.98); }
        .option-circle { 
            width: 20px; height: 20px; border: 2px solid #dfe4ea; border-radius: 50%; 
            margin-right: 15px; flex-shrink: 0; 
        }
        .option-text { font-size: 15px; color: #57606f; font-weight: 500; }

        /* 3. ç»“æœé¡µ */
        #result-page { animation: slideUp 0.6s ease; padding-bottom: 50px; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        /* é¡¶éƒ¨æ€»åˆ†å¡ (æ”¯æŒ4æ¡£é¢œè‰²) */
        .score-card {
            /* é»˜è®¤èƒŒæ™¯ï¼Œä¼šè¢«JSè¦†ç›– */
            background: linear-gradient(135deg, #ff4757, #ff7e5f);
            color: white; border-radius: 24px; padding: 30px; text-align: center;
            margin-bottom: 35px; box-shadow: 0 15px 30px rgba(255, 71, 87, 0.4);
            position: relative; overflow: hidden; transition: background 0.5s ease;
        }
        .score-card::after {
            content: ""; position: absolute; top: -50%; right: -50%; width: 200px; height: 200px;
            background: rgba(255,255,255,0.1); border-radius: 50%; pointer-events: none;
        }
        .big-score { font-size: 72px; font-weight: 800; line-height: 1; margin: 10px 0; text-shadow: 2px 2px 0 rgba(0,0,0,0.1); }
        .score-tag { background: rgba(0,0,0,0.2); padding: 6px 16px; border-radius: 20px; font-size: 13px; display: inline-block; backdrop-filter: blur(5px); }

        /* æ¨¡å—æ ‡é¢˜ */
        .section-header { 
            font-size: 18px; font-weight: 800; color: #2d3436; 
            margin-bottom: 20px; display: flex; align-items: center; 
        }
        .section-header::before { content: ''; width: 6px; height: 20px; background: var(--primary); margin-right: 10px; border-radius: 4px; }

        /* è¯Šæ–­å¡ç‰‡ */
        .diagnosis-card {
            background: #fff; border-radius: 18px; padding: 25px 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.03); border: 1px solid #f1f2f6; margin-bottom: 25px;
        }
        .diag-title { font-size: 17px; font-weight: 700; color: #2d3436; margin-bottom: 15px; display: flex; align-items: center; }
        
        /* ç°è‰²ä¸“ä¸šè§£é‡Šæ¡† */
        .term-box {
            background: #f8f9fa; border-radius: 8px; padding: 12px; margin: 15px 0;
            font-size: 12px; color: #636e72; line-height: 1.6; border-left: 3px solid #b2bec3;
        }
        .diag-text { font-size: 15px; color: #2d3436; line-height: 1.7; text-align: justify; }

        /* CPåŒ¹é…å¡ç‰‡ (å‚ç›´æ’åˆ—+æ‚¬æŒ‚ç¼©è¿›) */
        .cp-box {
            margin-top: 15px; padding-top: 15px; border-top: 1px dashed #dfe6e9;
            display: flex; flex-direction: column; gap: 12px;
        }
        .cp-row { display: flex; align-items: flex-start; font-size: 13px; line-height: 1.5; }
        .cp-label { font-weight: bold; color: var(--primary); margin-right: 6px; white-space: nowrap; flex-shrink: 0; }
        .cp-text { color: #2d3436; }

        /* å¤„æ–¹ç¬º */
        .prescription-paper {
            background: #fff9fa; border: 2px dashed #ffb8b8; border-radius: 20px; 
            padding: 25px 20px; position: relative; margin-top: 10px;
        }
        .paper-clip { 
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%); 
            width: 30px; height: 10px; background: #dcdde1; border-radius: 5px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .healing-msg { font-style: italic; color: #7f8fa6; font-size: 14px; margin-bottom: 20px; line-height: 1.6; }
        
        /* å¤„æ–¹ç¬ºåˆ—è¡¨æ ·å¼ */
        .action-step { display: flex; margin-bottom: 20px; align-items: flex-start; }
        .action-label {
            background: var(--primary); color: white; font-size: 12px; font-weight: bold;
            padding: 5px 10px; border-radius: 8px; margin-right: 12px; flex-shrink: 0;
            box-shadow: 0 4px 10px rgba(255, 71, 87, 0.2);
        }
        .action-content { font-size: 14px; color: #2d3436; line-height: 1.6; text-align: justify; }

        /* ç¤¾äº¤äººè®¾å¡ (æˆªå›¾å¼•æµ) */
        .social-card {
            background: #2f3542; color: #f1f2f6; border-radius: 16px; padding: 25px;
            text-align: center; margin-top: 40px; position: relative; overflow: hidden;
        }
        .social-title { font-size: 12px; letter-spacing: 2px; opacity: 0.6; margin-bottom: 10px; text-transform: uppercase; }
        .social-quote { font-size: 16px; font-weight: bold; font-family: "Songti SC", serif; line-height: 1.5; margin-bottom: 20px; color: #fff; }
        .social-tags { display: flex; justify-content: center; gap: 10px; }
        .s-tag { background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 4px; font-size: 12px; }
        
        /* æ–°å¢ï¼šæˆªå›¾å¼•å¯¼æŒ‰é’® */
        .screenshot-hint-btn {
            display: block; margin: 20px auto 0 auto;
            background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.8);
            font-size: 12px; padding: 8px 15px; border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.2); cursor: pointer;
        }

        /* åŠ è½½åŠ¨ç”» */
        #loading-page { height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; text-align: center; }
        .spinner { width: 50px; height: 50px; border: 4px solid #f3f3f3; border-top: 4px solid var(--primary); border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
</head>
<body>

<div class="container">
    <div id="landing-page">
        <div class="logo-emoji">ğŸ©</div>
        <h1>äº²å¯†å…³ç³»æ·±åº¦æ‰«æ</h1>
        <p class="sub-title">å¬è§èº«ä½“æ²¡è¯´å‡ºå£çš„è¯ Â· çµé­‚ç‰ˆ</p>
        
        <div class="login-box">
            <p style="font-weight: bold; margin-bottom: 15px;">å¼€å¯ä½ çš„æ·±åº¦æŠ¥å‘Šï¼š</p>
            <input type="text" id="access-code" class="input-box" placeholder="è¯·è¾“å…¥è§£é”ç ..." autocomplete="off">
            <button class="btn" onclick="startTest()">å¼€å§‹æ‰«æ</button>
            <p style="font-size: 12px; color: #b2bec3; margin-top: 20px; text-align: center;">
                * 16é“æƒ…å¢ƒå¼æµ‹è¯„ï¼Œé¢„è®¡è€—æ—¶3åˆ†é’Ÿ
            </p>
        </div>
    </div>

    <div id="quiz-page" class="hidden">
        <div class="progress-bar"><div class="progress-fill" id="progress"></div></div>
        
        <div style="text-align: right; margin-bottom: 10px; font-size: 12px; color: #b2bec3; font-weight: bold;">
            <span id="q-curr">1</span> / <span id="q-total">16</span>
        </div>
        
        <div class="q-tag" id="q-tag">Tag</div>
        <div class="q-text" id="q-title">é¢˜ç›®åŠ è½½ä¸­...</div>
        <div id="options-container"></div>
    </div>

    <div id="loading-page" class="hidden">
        <div class="spinner"></div>
        <h3 style="color: #2d3436; margin-bottom: 10px;">AI æƒ…æ„Ÿä¸“å®¶æ­£åœ¨ä¼šè¯Š</h3>
        <p id="loading-text" style="color: #636e72; font-size: 14px;">æ­£åœ¨è§£è¯»æ½œæ„è¯†ä¿¡å·...</p>
    </div>

    <div id="result-page" class="hidden">
        <div class="score-card" id="score-card-bg">
            <div style="opacity: 0.9; font-size: 14px; margin-bottom: 5px;">äº²å¯†å…³ç³»èƒ½é‡æŒ‡æ•°</div>
            <div class="big-score" id="final-score">--</div>
            <div class="score-tag" id="score-comment">æ­£åœ¨ç”Ÿæˆ...</div>
        </div>

        <div style="margin-bottom: 30px;">
            <div class="section-header">èƒ½é‡åˆ†å¸ƒå›¾è°±</div>
            <div style="position: relative; height: 220px; width: 100%;">
                <canvas id="radarChart"></canvas>
            </div>
        </div>

        <div style="margin-bottom: 30px;">
            <div class="section-header">ä½ çš„çµé­‚åº•è‰²</div>
            
            <div class="diagnosis-card">
                <div class="diag-title">
                    <span style="font-size:20px; margin-right:8px;">ğŸ¦‹</span> 
                    æ€§çˆ±äººæ ¼ (Erotic Persona)
                </div>
                <div id="type-content"></div>
            </div>

            <div class="diagnosis-card">
                <div class="diag-title">
                    <span style="font-size:20px; margin-right:8px;">ğŸ”’</span> 
                    å†…å¿ƒå®‰å…¨é” (Inner Security Lock)
                </div>
                <div id="brake-content"></div>
            </div>
        </div>

        <div style="margin-bottom: 40px;">
            <div class="section-header">ç»™å…³ç³»çš„çµè¯</div>
            <div class="prescription-paper">
                <div class="paper-clip"></div>
                <div class="healing-msg" id="healing-intro"></div>
                <div id="action-plan"></div>
            </div>
        </div>

        <div class="social-card">
            <div class="social-title">MY INTIMACY REPORT</div>
            <div class="social-quote" id="social-quote">"æ‰€è°“äº²å¯†ï¼Œä¸è¿‡æ˜¯èº«ä½“ç»ˆäºæ‰¾åˆ°äº†å®ƒçš„æ¯è¯­ã€‚"</div>
            <div class="social-tags" id="social-tags">
                <span class="s-tag">#æ„Ÿå®˜å‹</span>
                <span class="s-tag">#é«˜æ•æ„Ÿ</span>
            </div>
            <button class="screenshot-hint-btn">ğŸ‘‰ é•¿æŒ‰ä¿å­˜ / æˆªå›¾åˆ†äº«ä½ çš„çµé­‚åº•è‰²</button>
        </div>
    </div>
</div>

<script>
    // ================= é…ç½®åŒº =================
    const VALID_CODES = ["888888", "Love2024", "A1B2C3", "Test001"];

    // ================= 16é“å¤§å¸ˆçº§æ‰å¿ƒé¢˜åº“ (V4.1å®Œæ•´ç‰ˆ) =================
    // é¢˜åº“å†…å®¹ä¿æŒä¸å˜ï¼Œç›´æ¥ä½¿ç”¨ä¸Šä¸€ç‰ˆçš„æˆç†Ÿé¢˜åº“
    const questions = [
        // --- ç¬¬ä¸€ç»´åº¦ï¼šç°çŠ¶ (4é¢˜) ---
        { category: "èƒ½é‡åœºÂ·é¢‘ç‡", title: "é™¤å»ç”Ÿç†æœŸï¼Œæœ€è¿‘ä¸¤ä¸ªæœˆï¼Œä½ ä»¬æ·±å±‚äº²å¯†æ¥è§¦ï¼ˆDoï¼‰çš„çœŸå®çŠ¶æ€æ˜¯ï¼Ÿ", options: [{ text: "å¹²æŸ´çƒˆç«ï¼šæ¯å‘¨2æ¬¡ä»¥ä¸Šï¼Œå……æ»¡æ¿€æƒ…", score: 100, dimension: "frequency" }, { text: "ç»†æ°´é•¿æµï¼šæ¯å‘¨1æ¬¡å·¦å³ï¼Œè§„å¾‹ä¸”ç¨³å®š", score: 80, dimension: "frequency" }, { text: "ä¾‹è¡Œå…¬äº‹ï¼šåŠä¸ªæœˆ1æ¬¡ï¼Œåƒå®Œæˆä»»åŠ¡", score: 50, dimension: "frequency" }, { text: "å®¤å‹æ¨¡å¼ï¼šä¸€ä¸ªæœˆä»¥ä¸Šæ²¡æœ‰äº†ï¼Œå¿ƒå¦‚æ­¢æ°´", score: 20, dimension: "frequency" }] },
        { category: "èƒ½é‡åœºÂ·è·ç¦»", title: "æ™šä¸Šå…³ç¯ç¡è§‰æ—¶ï¼Œä½ ä»¬é€šå¸¸çš„èº«ä½“è·ç¦»æ˜¯ï¼Ÿ", options: [{ text: "è¿ä½“å©´ï¼šå¿…é¡»ç´§ç´§æŠ±ç€æ‰èƒ½ç¡ç€", score: 100, dimension: "passion" }, { text: "æ­ä¼™äººï¼šä¼šæœ‰è‚¢ä½“æ­åœ¨å¯¹æ–¹èº«ä¸Š", score: 80, dimension: "passion" }, { text: "æ¥šæ²³æ±‰ç•Œï¼šå„ç¡å„çš„ï¼Œå°½é‡äº’ä¸å¹²æ‰°", score: 40, dimension: "passion" }, { text: "èƒŒå¯¹èƒŒï¼šèƒŒå¯¹ç€ç¡ï¼Œå¾ˆä¹…éƒ½ä¸æ•¢ç¿»èº«", score: 20, dimension: "passion" }] },
        { category: "èƒ½é‡åœºÂ·å¿ƒåŠ¨", title: "å¦‚æœä¸å‘ç”Ÿå…³ç³»ï¼Œä½ ä»¬ç°åœ¨è¿˜ä¼šæ·±æƒ…æ¥å»ï¼ˆèˆŒå»ï¼‰å—ï¼Ÿ", options: [{ text: "ä¼šï¼Œå‡ºé—¨å‰æˆ–ç¡å‰éƒ½ä¼šè‡ªç„¶çš„æ·±å»", score: 100, dimension: "passion" }, { text: "åªæœ‰åœ¨â€œåŠäº‹â€çš„å‰æˆé‡Œæ‰ä¼šï¼Œåƒä¸ªç¨‹åº", score: 60, dimension: "passion" }, { text: "å¾ˆä¹…æ²¡æœ‰äº†ï¼Œç°åœ¨çš„äº²äº²åªæ˜¯ç¢°ä¸€ä¸‹å˜´çš®å­", score: 20, dimension: "passion" }] },
        { category: "èƒ½é‡åœºÂ·ä¸»åŠ¨", title: "é€šå¸¸æ˜¯è°å…ˆå‘èµ·ä¿¡å·ï¼Ÿ", options: [{ text: "é»˜å¥‘ï¼šçœ¼ç¥å¯¹ä¸Šå°±æ‡‚äº†", score: 90, dimension: "frequency" }, { text: "è¢«åŠ¨ï¼šåŸºæœ¬éƒ½æ˜¯å¯¹æ–¹ï¼Œæˆ‘é…åˆ", score: 60, dimension: "frequency" }, { text: "å¿ƒç´¯ï¼šåŸºæœ¬éƒ½æ˜¯æˆ‘ï¼Œç»å¸¸è§‰å¾—è‡ªå·±åƒä¸ªä¹ä¸", score: 30, dimension: "frequency" }, { text: "è£…å‚»ï¼šæ²¡äººå‘èµ·ï¼Œéƒ½åœ¨å‡è£…ç©æ‰‹æœº", score: 10, dimension: "frequency" }] },
        // --- ç¬¬äºŒç»´åº¦ï¼šäººæ ¼ (4é¢˜) ---
        { category: "çµé­‚Â·åå¥½", title: "ç›¸æ¯”äºç›´å¥”ä¸»é¢˜ï¼Œä½ æ˜¯å¦éœ€è¦é•¿æ—¶é—´çš„æŒ‰æ‘©ã€æ‹¥æŠ±å’Œç¯å¢ƒæ°›å›´é“ºå«ï¼Ÿ", options: [{ text: "æ˜¯çš„ï¼Œæ²¡æœ‰é“ºå«æˆ‘å®Œå…¨æ²¡æ„Ÿè§‰ï¼Œç”šè‡³åæ„Ÿ", type: "Sensual", score: 80, dimension: "skill" }, { text: "çœ‹æƒ…å†µï¼Œæœ‰æ—¶å€™ä¹Ÿå–œæ¬¢å¿«èŠ‚å¥çš„åˆºæ¿€", type: "Normal", score: 60, dimension: "skill" }, { text: "ä¸éœ€è¦ï¼Œå¼ºçƒˆçš„è§†è§‰/åŠ¨ä½œåˆºæ¿€æ›´é‡è¦", type: "Visual", score: 60, dimension: "skill" }] },
        { category: "çµé­‚Â·å¼€å…³", title: "å½“çœ‹åˆ°ä¼´ä¾£ç©¿ç€ç‰¹å®šçš„æ€§æ„Ÿè£…æ‰®ï¼Œæˆ–åœ¨æ˜äº®ç¯å…‰ä¸‹ï¼Œä½ çš„ååº”æ˜¯ï¼Ÿ", options: [{ text: "ç¬é—´ç‚¹ç‡ƒï¼šè§†è§‰å†²å‡»å¯¹æˆ‘æ˜¯ç¬¬ä¸€æ‰“ç«æœº", type: "Visual", score: 80, dimension: "passion" }, { text: "ä¸€èˆ¬èˆ¬ï¼šæˆ‘æ›´çœ‹é‡æ°”å‘³ã€å£°éŸ³å’Œè§¦æ„Ÿ", type: "Sensual", score: 60, dimension: "passion" }, { text: "æ— æ„Ÿï¼šæˆ‘æ›´åœ¨ä¹å½“ä¸‹çš„æƒ…æ„Ÿé“¾æ¥", type: "Normal", score: 60, dimension: "passion" }] },
        { category: "çµé­‚Â·æ¢ç´¢", title: "å¯¹äºå°è¯•æ–°èŠ±æ ·ï¼ˆå¦‚ç©å…·ã€è§’è‰²æ‰®æ¼”ã€æ–°åœ°ç‚¹ï¼‰ï¼Œä½ çš„æ€åº¦æ˜¯ï¼Ÿ", options: [{ text: "éå¸¸æœŸå¾…ï¼Œæ—©å°±æƒ³è¯•äº†", score: 100, dimension: "skill" }, { text: "æœ‰ç‚¹å®³ç¾ï¼Œä½†å¯¹æ–¹å¼•å¯¼çš„è¯æ„¿æ„è¯•", score: 80, dimension: "skill" }, { text: "æ’æ–¥ï¼Œè§‰å¾—é‚£æ ·å¾ˆå¥‡æ€ª", score: 20, dimension: "skill" }] },
        { category: "çµé­‚Â·é“¾æ¥", title: "å¦‚æœä»Šå¤©å‘ç”Ÿè¿‡æ·±åº¦çš„çµé­‚æ²Ÿé€šï¼ˆèŠå¾—å¾ˆå¼€å¿ƒï¼‰ï¼Œæ™šä¸Šä½ ä¼šæ›´å®¹æ˜“æƒ³è¦å—ï¼Ÿ", options: [{ text: "ä¼šï¼å¿ƒè¿‘äº†èº«ä½“æ‰æƒ³è¿‘", type: "Sensual", score: 100, dimension: "skill" }, { text: "æ²¡å¤ªå¤§å…³ç³»ï¼Œèº«ä½“å½’èº«ä½“", type: "Visual", score: 60, dimension: "skill" }] },
        // --- ç¬¬ä¸‰ç»´åº¦ï¼šåˆ¹è½¦ (4é¢˜) ---
        { category: "é˜»æ–­Â·ç¯å¢ƒ", title: "å¦‚æœåœ¨è¿‡ç¨‹ä¸­çªç„¶å¬åˆ°é—¨å¤–æœ‰å¼‚å“ï¼ˆå¦‚å®¶äºº/å®¤å‹ï¼‰ï¼Œä½ ä¼šï¼Ÿ", options: [{ text: "ç¬é—´æ²¡å…´è‡´ï¼Œå¿…é¡»åœä¸‹ç¡®è®¤å®‰å…¨", score: 40, dimension: "safe", brake: "High" }, { text: "æœ‰ç‚¹ç´§å¼ ï¼Œä½†ç¡®è®¤æ²¡äº‹èƒ½ç»§ç»­", score: 70, dimension: "safe", brake: "Medium" }, { text: "å®Œå…¨ä¸å½±å“ï¼Œç”šè‡³è§‰å¾—æ›´åˆºæ¿€", score: 100, dimension: "safe", brake: "Low" }] },
        { category: "é˜»æ–­Â·è‡ªæˆ‘", title: "å½“ä»–çš„æ‰‹è§¦ç¢°åˆ°ä½ çš„è…°æˆ–è‚šå­æ—¶ï¼Œä½ çš„ä¸‹æ„è¯†ååº”æ˜¯ï¼Ÿ", options: [{ text: "ç¬é—´å¸æ°”æ”¶è…¹ï¼Œç”šè‡³æƒ³æŠŠä»–çš„æ‰‹æ‹¿å¼€", score: 40, dimension: "safe", brake: "High" }, { text: "å¾ˆæ”¾æ¾ï¼Œä»»ç”±ä»–è§¦ç¢°", score: 80, dimension: "safe", brake: "Medium" }, { text: "ç‰¹æ„å±•ç¤ºæ›²çº¿ï¼Œè§‰å¾—æˆ‘å¾ˆè¿·äºº", score: 100, dimension: "safe", brake: "Low" }] },
        { category: "é˜»æ–­Â·æƒ…ç»ª", title: "å¦‚æœç™½å¤©åˆšåµäº†ä¸€æ¶ï¼Œæ™šä¸Šå¯¹æ–¹æ¥æ±‚å’Œï¼Œä½ ä¼šï¼Ÿ", options: [{ text: "æ»šï¼Œåˆ«ç¢°æˆ‘ï¼ˆæƒ…ç»ªæœªæ¶ˆæ— æ³•èº«ä½“æ¥è§¦ï¼‰", score: 30, dimension: "safe", brake: "High" }, { text: "å¯ä»¥åšï¼Œåšå®Œä¹Ÿè®¸å°±å¥½äº†ï¼ˆæ€§çˆ±åˆ†ç¦»ï¼‰", score: 90, dimension: "safe", brake: "Low" }] },
        { category: "é˜»æ–­Â·å‹åŠ›", title: "å½“å·¥ä½œå‹åŠ›å·¨å¤§ã€ç‰¹åˆ«ç–²æƒ«çš„æ—¶å€™ï¼Œäº²çƒ­å¯¹ä½ æ¥è¯´æ˜¯ï¼Ÿ", options: [{ text: "æ˜¯è´Ÿæ‹…ï¼Œåªæƒ³ç¡è§‰ï¼Œåˆ«çƒ¦æˆ‘", score: 40, dimension: "safe", brake: "High" }, { text: "æ˜¯è§£å‹æ–¹å¼ï¼Œåšå®Œæ›´è½»æ¾", score: 100, dimension: "safe", brake: "Low" }] },
        // --- ç¬¬å››ç»´åº¦ï¼šæœªæ¥ (4é¢˜) ---
        { category: "é¢„åÂ·ç»“å±€", title: "å¦‚æœä¸€æ–¹å‘å‡ºçš„ä¿¡å·è¢«â€œå†·å¤„ç†â€æˆ–æ‹’ç»äº†ï¼Œå½“æ™šå…³ç¯åçš„ç©ºæ°”æ˜¯æ€æ ·çš„ï¼Ÿ", options: [{ text: "åƒæ²¡å‘ç”Ÿè¿‡ä¸€æ ·ï¼Œä¾ç„¶æŠ±åœ¨ä¸€èµ·ç¡", score: 90, dimension: "comm" }, { text: "æœ‰ç‚¹å°´å°¬ï¼ŒèƒŒå¯¹èƒŒæ²‰é»˜", score: 60, dimension: "comm" }, { text: "è¢«æ‹’çš„é‚£æ–¹èƒŒå¯¹ç€ç¡ï¼Œå¾ˆä¹…éƒ½ä¸æ•¢ç¿»èº«", score: 20, dimension: "comm" }] },
        { category: "é¢„åÂ·æ²Ÿé€š", title: "ä½ ä»¬æœ€è¿‘ä¸€æ¬¡è¿›è¡Œæ·±åº¦çš„ã€ä¸çœ‹æ‰‹æœºçš„è°ˆå¿ƒï¼Œæ˜¯ä»€ä¹ˆæ—¶å€™ï¼Ÿ", options: [{ text: "æœ€è¿‘ä¸‰å¤©å†…", score: 100, dimension: "comm" }, { text: "åŠä¸ªæœˆå·¦å³", score: 70, dimension: "comm" }, { text: "ä¸è®°å¾—äº†ï¼Œå¹³æ—¶åªèŠå®¶åŠ¡çäº‹", score: 30, dimension: "comm" }] },
        { category: "é¢„åÂ·å±•æœ›", title: "è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœä½ ä½™ç”Ÿå‡ åå¹´çš„äº²å¯†è´¨é‡éƒ½ç»´æŒç°åœ¨çš„çŠ¶æ€ï¼Œä½ èƒ½æ¥å—å—ï¼Ÿ", options: [{ text: "æ²¡é—®é¢˜ï¼Œç°åœ¨çš„çŠ¶æ€è®©æˆ‘å¾ˆå®‰å¿ƒ", score: 100, dimension: "comm" }, { text: "çŠ¹è±«ï¼Œè§‰å¾—æœ‰ç‚¹åƒç™½å¼€æ°´ï¼Œä½†ä¹Ÿå‡‘åˆ", score: 50, dimension: "comm" }, { text: "ç¬é—´æ„Ÿåˆ°çª’æ¯/ç»æœ›ï¼Œæƒ³é€ƒç¦»", score: 0, dimension: "comm" }] },
        { category: "é¢„åÂ·æ„æ„¿", title: "å¦‚æœå¯¹æ–¹æå‡ºæƒ³å’Œä½ å¥½å¥½èŠèŠâ€œä¸å’Œè°â€çš„é—®é¢˜ï¼Œä½ ä¼šï¼Ÿ", options: [{ text: "éå¸¸æ„¿æ„ï¼Œå¸Œæœ›èƒ½ä¸€èµ·è§£å†³", score: 100, dimension: "comm" }, { text: "æœ‰ç‚¹å°´å°¬ï¼Œä½†ä¼šé…åˆ", score: 70, dimension: "comm" }, { text: "å›é¿ï¼Œè§‰å¾—æ²¡ä»€ä¹ˆå¥½èŠçš„", score: 20, dimension: "comm" }] }
    ];

    // ================= é€»è¾‘å¼•æ“ =================
    let currentStep = 0;
    let scores = { frequency:0, passion:0, skill:0, safe:0, comm:0 };
    let counts = { frequency:0, passion:0, skill:0, safe:0, comm:0 };
    let types = { Sensual:0, Visual:0, Normal:0 };
    let brakes = [];

    document.getElementById('q-total').innerText = questions.length;

    function startTest() {
        const code = document.getElementById('access-code').value.trim();
        if(VALID_CODES.includes(code)) {
            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('quiz-page').classList.remove('hidden');
            renderQuestion();
        } else {
            alert("è§£é”ç é”™è¯¯ï¼Œè¯·æ£€æŸ¥æ˜¯å¦è¾“å…¥æ­£ç¡®");
        }
    }

    function renderQuestion() {
        if(currentStep >= questions.length) return finishTest();
        const q = questions[currentStep];
        document.getElementById('progress').style.width = ((currentStep+1)/questions.length)*100 + "%";
        document.getElementById('q-curr').innerText = currentStep + 1;
        document.getElementById('q-tag').innerText = q.category;
        document.getElementById('q-title').innerText = q.title;
        
        let html = '';
        q.options.forEach((opt, idx) => {
            html += `<div class="option-card" onclick="selectOpt(${idx})">
                        <div class="option-circle"></div>
                        <div class="option-text">${opt.text}</div>
                     </div>`;
        });
        document.getElementById('options-container').innerHTML = html;
    }

    function selectOpt(idx) {
        const q = questions[currentStep];
        const opt = q.options[idx];
        if(opt.dimension) { scores[opt.dimension]+=opt.score; counts[opt.dimension]++; }
        if(opt.type) types[opt.type]++;
        if(opt.brake) brakes.push(opt.score);
        currentStep++;
        setTimeout(renderQuestion, 250);
    }

    function finishTest() {
        document.getElementById('quiz-page').classList.add('hidden');
        document.getElementById('loading-page').classList.remove('hidden');
        
        const texts = ["æ­£åœ¨é“¾æ¥æ½œæ„è¯†...", "æ­£åœ¨åˆ†æèƒ½é‡é˜»æ–­...", "æ­£åœ¨ç”Ÿæˆçµé­‚å¤„æ–¹..."];
        let i=0;
        let timer = setInterval(() => {
            document.getElementById('loading-text').innerText = texts[i%texts.length];
            i++;
        }, 1200);

        setTimeout(() => {
            clearInterval(timer);
            showResult();
        }, 3500);
    }

    function showResult() {
        document.getElementById('loading-page').classList.add('hidden');
        document.getElementById('result-page').classList.remove('hidden');

        // è®¡ç®—
        let radarData = ["frequency","passion","skill","safe","comm"].map(k => counts[k]? Math.round(scores[k]/counts[k]):60);
        let finalScore = Math.round(radarData.reduce((a,b)=>a+b,0)/5);
        
        // é¡¶éƒ¨åˆ†æ•°é€»è¾‘ (å‡çº§ä¸º4æ¡£)
        document.getElementById('final-score').innerText = finalScore;
        let comment = "";
        let bgStyle = "";

        if(finalScore > 85) {
            comment = "ç¥ä»™çœ·ä¾£ (çµé­‚å…±æŒ¯)";
            bgStyle = "linear-gradient(135deg, #2ed573, #7bed9f)"; // ç»¿è‰²å¥åº·
        } else if (finalScore > 70) {
            comment = "äºšå¥åº· (æ³¢åŠ¨æœŸ)";
            bgStyle = "linear-gradient(135deg, #ffa502, #ffc048)"; // é»„è‰²é¢„è­¦
        } else if (finalScore > 50) {
            comment = "åˆç§Ÿå®¤å‹ (ç¼ºä¹å†²åŠ¨)";
            bgStyle = "linear-gradient(135deg, #ff7f50, #ff6b81)"; // æ©™çº¢å±é™©
        } else {
            comment = "ä¸§å¶å¼å…³ç³» (å¿ƒéš”ç‰‡æµ·)";
            bgStyle = "linear-gradient(135deg, #d63031, #ff7675)"; // æ·±çº¢ICU
        }
        document.getElementById('score-comment').innerText = comment;
        document.getElementById('score-card-bg').style.background = bgStyle;

        // é›·è¾¾
        new Chart(document.getElementById('radarChart'), {
            type: 'radar',
            data: {
                labels: ["é¢‘ç‡", "æ¿€æƒ…", "æŠ€å·§", "å®‰å…¨æ„Ÿ", "æ²Ÿé€š"],
                datasets: [{
                    label: 'èƒ½é‡åˆ†å¸ƒ', data: radarData,
                    backgroundColor: 'rgba(255, 71, 87, 0.2)', borderColor: '#ff4757', borderWidth: 2, pointBackgroundColor: '#ff4757'
                }]
            },
            options: { scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: {display:false} } }, plugins: { legend: {display:false} } }
        });

        // è¯Šæ–­é€»è¾‘
        let maxType = "Normal";
        if(types.Sensual >= types.Visual && types.Sensual >= types.Normal) maxType = "Sensual";
        else if(types.Visual >= types.Sensual && types.Visual >= types.Normal) maxType = "Visual";
        
        let avgBrake = brakes.length ? (brakes.reduce((a,b)=>a+b,0)/brakes.length) : 60;
        let brakeLevel = avgBrake <= 60 ? "High" : "Low";

        // --- äººæ ¼æ–‡æ¡ˆ (ä¿®å¤å¯¹é½) ---
        let typeHtml = "";
        let socialTag = "";
        let socialQuote = "";

        if(maxType === "Sensual") {
            socialTag = "#é«˜æ•æ„ŸÂ·çŒ«ç³»";
            socialQuote = "çˆ±å¯¹ä½ æ¥è¯´ï¼Œæ˜¯çš®è‚¤ä¸Šçš„è¯—å¥ã€‚";
            typeHtml = `
                <div style="font-weight:bold; font-size:16px; color:#d35400; margin-bottom:5px;">é«˜æ•æ„ŸÂ·çŒ«ç³» (Sensual)</div>
                <div class="diag-text">
                    ä½ åƒä¸€åªä¼˜é›…çš„çŒ«ã€‚ä½ éœ€è¦çš„ä¸æ˜¯ç›´å¥”ä¸»é¢˜çš„â€œäº¤ä½œä¸šâ€ï¼Œè€Œæ˜¯æ¼«é•¿çš„ã€å……æ»¡äº†çˆ±æ„çš„é¢„çƒ­ã€‚ä½ ç°åœ¨çš„æŠ—æ‹’ï¼Œå¾ˆå¯èƒ½æ˜¯å› ä¸ºä½ çš„èº«ä½“è§‰å¾—è¢«â€œå†’çŠ¯â€äº†ã€‚
                </div>
                <div class="cp-box">
                    <div class="cp-row">
                        <span class="cp-label">â¤ï¸ ç»é…ï¼š</span><span class="cp-text">èƒ½é‡å‹ (æ‡‚ä½ çš„çµé­‚ï¼Œä¸æ€¥äºæ±‚æˆ)</span>
                    </div>
                    <div class="cp-row">
                        <span class="cp-label">âš”ï¸ å¤©æ•Œï¼š</span><span class="cp-text">æœºæ¢°å‹ (åªèµ°ç¨‹åºï¼Œæ²¡æœ‰å‰æˆ)</span>
                    </div>
                </div>
                <div class="term-box">
                    <span style="font-weight:bold;">âœ¨ èƒ½é‡è§£è¯»ï¼š</span>
                    ä½ çš„çš®è‚¤æ˜¯æ¥æ”¶çˆ±çš„å¤©çº¿ã€‚å½“ä½ æ„Ÿåˆ°è¢«çˆ±æ—¶ï¼Œä½ æ¯”è°éƒ½æŸ”è½¯ï¼›å½“ä½ æ„Ÿåˆ°å‹åŠ›æ—¶ï¼Œä½ ä¼šç¬é—´ç‚¸æ¯›å¹¶é€ƒç¦»ã€‚
                </div>`;
        } else if(maxType === "Visual") {
            socialTag = "#è§†è§‰ç³»Â·çŒæ‰‹";
            socialQuote = "çˆ±æ˜¯çœ¼é‡Œçš„ç«ç„°ï¼Œå§‹äºå‡è§†ï¼Œç»ˆäºç‡ƒçƒ§ã€‚";
            typeHtml = `
                <div style="font-weight:bold; font-size:16px; color:#c0392b; margin-bottom:5px;">è§†è§‰ç³»Â·çŒæ‰‹ (Visual)</div>
                <div class="diag-text">
                    ä½ æ˜¯çƒ­æƒ…çš„ç«ç„°ã€‚ä½ å®¹æ˜“è¢«è§†è§‰ç¬¦å·ï¼ˆèº«æ/çœ¼ç¥/ç¯å…‰ï¼‰ç‚¹ç‡ƒã€‚ç°åœ¨çš„å¹³æ·¡ï¼Œå¾ˆå¤§ç¨‹åº¦æ˜¯å› ä¸ºç”Ÿæ´»ä¸­ç¼ºä¹äº†è¿™äº›è®©ä½ çœ¼å‰ä¸€äº®çš„â€œä¿¡å·â€ã€‚
                </div>
                <div class="cp-box">
                    <div class="cp-row">
                        <span class="cp-label">â¤ï¸ ç»é…ï¼š</span><span class="cp-text">å¤§èƒ†å‹ (æ•¢äºå±•ç¤ºï¼Œè®©ä½ ç›®ä¸è½¬ç›)</span>
                    </div>
                    <div class="cp-row">
                        <span class="cp-label">âš”ï¸ å¤©æ•Œï¼š</span><span class="cp-text">ä¿å®ˆå‹ (æ°¸è¿œå…³ç¯ï¼Œç¼ºä¹è§†è§‰æƒŠå–œ)</span>
                    </div>
                </div>`;
        } else {
            socialTag = "#æµåŠ¨å‹Â·çµé­‚";
            socialQuote = "èº«ä½“çš„çº ç¼ ï¼Œæœ¬è´¨æ˜¯èƒ½é‡çš„å…±æŒ¯ã€‚";
            typeHtml = `
                <div style="font-weight:bold; font-size:16px; color:#0984e3; margin-bottom:5px;">æµåŠ¨å‹Â·é€šçµè€… (Energetic)</div>
                <div class="diag-text">
                    ä½ éå¸¸çœ‹é‡â€œèƒ½é‡æµåŠ¨â€ã€‚å¦‚æœä¸¤ä¸ªäººæƒ…ç»ªä¸åŒé¢‘ï¼Œæˆ–è€…åˆšåµå®Œæ¶ï¼Œä½ çš„èº«ä½“ä¼šæœ¬èƒ½åœ°å…³é—­ã€‚ä½ éœ€è¦çš„æ˜¯å…ˆè¿å¿ƒï¼Œå†è¿èº«ã€‚
                </div>
                <div class="cp-box">
                    <div class="cp-row">
                        <span class="cp-label">â¤ï¸ ç»é…ï¼š</span><span class="cp-text">çµé­‚ä¼´ä¾£ (æƒ…ç»ªåŒé¢‘)</span>
                    </div>
                    <div class="cp-row">
                        <span class="cp-label">âš”ï¸ å¤©æ•Œï¼š</span><span class="cp-text">å†·æ¼ å‹ (æ‹’ç»æ²Ÿé€š)</span>
                    </div>
                </div>`;
        }
        document.getElementById('type-content').innerHTML = typeHtml;
        document.getElementById('social-quote').innerText = socialQuote;
        document.getElementById('social-tags').innerHTML = `<span class="s-tag">${socialTag}</span><span class="s-tag">#äº²å¯†å…³ç³»</span>`;

        // --- åˆ¹è½¦æ–‡æ¡ˆ (æ”¹åä¼˜åŒ–+è§£é‡Šä¼˜åŒ–) ---
        let brakeHtml = "";
        if(brakeLevel === "High") {
            brakeHtml = `
                <div style="font-weight:bold; font-size:16px; color:#c0392b; margin-bottom:5px;">é«˜æ•Â·å®‰å…¨é” (Sensitive Lock)</div>
                <div class="diag-text">
                    ä½ ä¸æ˜¯â€œå†·æ·¡â€ï¼Œä½ æ˜¯â€œé«˜å‹å—å®³è€…â€ã€‚ä½ çš„å†…å¿ƒæœ‰ä¸€æŠŠæçµæ•çš„å®‰å…¨é”ã€‚å‹åŠ›ã€èº«æç„¦è™‘ã€æˆ–ç¯å¢ƒå™ªéŸ³ï¼Œéƒ½ä¼šä¼˜å…ˆè§¦å‘ä½ çš„é˜²å¾¡æœºåˆ¶ã€‚
                </div>
                <div class="term-box">
                    <span style="font-weight:bold;">ğŸ’¡ æ‡‚ä½ ï¼š</span>
                    è¿™è¯´æ˜ä½ æ˜¯ä¸€ä¸ªå¿ƒæ€ç»†è…»çš„äººã€‚åªæœ‰åœ¨ç»å¯¹æ”¾æ¾ã€è¢«å® çˆ±çš„ç¯å¢ƒé‡Œï¼Œä½ çš„é”æ‰ä¼šæ‰“å¼€ã€‚
                </div>`;
        } else {
             brakeHtml = `
                <div style="font-weight:bold; font-size:16px; color:#27ae60; margin-bottom:5px;">å¹³è¡¡Â·å®‰å…¨é” (Balanced Lock)</div>
                <div class="diag-text">
                    ä½ çš„ç”Ÿç†æœºåˆ¶å¾ˆå¥åº·ã€‚å¦‚æœä¸æƒ³åšï¼Œæ›´å¤šæ˜¯å› ä¸ºæƒ…æ„Ÿè¿æ¥æˆ–æ²Ÿé€šæ–¹å¼å‡ºç°äº†é”™ä½ï¼Œè€Œéç”Ÿç†å±‚é¢çš„æŠ‘åˆ¶ã€‚
                </div>`;
        }
        document.getElementById('brake-content').innerHTML = brakeHtml;

        // --- å¤„æ–¹å»ºè®® ---
        let healHtml = `äº²çˆ±çš„ï¼Œçœ‹åˆ°è¿™ä¸ªç»“æœè¯·ä¸è¦ç„¦è™‘ã€‚<b>æ‹’ç»ä¸æ˜¯å› ä¸ºä¸çˆ±ï¼Œè€Œæ˜¯å› ä¸ºèº«ä½“æ²¡æœ‰è¢«â€œæ­£ç¡®åœ°å¬è§â€</b>ã€‚æ—¢ç„¶ä»–ä¸æ‡‚è¿™äº›ï¼Œé‚£å°±ç”±ä½ æ¥å¼•å¯¼ä»–ã€‚`;
        document.getElementById('healing-intro').innerHTML = healHtml;

        let actionHtml = "";
        if(maxType === "Sensual") {
            actionHtml += `<div class="action-step"><div class="action-label">è„±æ•ç»ƒä¹ </div><div class="action-content">æœ¬å‘¨çº¦å®šä¸€æ¬¡â€œåªè®¸æŠšæ‘¸ï¼Œä¸è®¸è¶Šç•Œâ€çš„æ—¶é—´ã€‚å‘Šè¯‰ä»–ï¼šâ€œä»Šæ™šæˆ‘åªæƒ³è®©ä½ æŠ±æˆ‘ã€æ‘¸æˆ‘çš„åèƒŒ15åˆ†é’Ÿï¼Œç»å¯¹ä¸å¯ä»¥åšæœ€åä¸€æ­¥ã€‚â€è¿™èƒ½è®©ä½ ç´§ç»·çš„é˜²å¾¡æœºåˆ¶æ”¾æ¾ä¸‹æ¥ã€‚</div></div>`;
        } else {
            actionHtml += `<div class="action-step"><div class="action-label">è§†è§‰å”¤é†’</div><div class="action-content">åˆ«å…³ç¯ï¼æˆ–è€…ç•™ä¸€ç›æš–é»„è‰²çš„å°ç¯ã€‚å°è¯•ä¸€ä»¶ä½ å¾ˆä¹…æ²¡ç©¿è¿‡çš„é£æ ¼ï¼Œåˆ©ç”¨è§†è§‰å·®æ¥é‡æ–°æ¿€æ´»ä»–çš„å¤šå·´èƒºã€‚</div></div>`;
        }
        if(brakeLevel === "High") {
            actionHtml += `<div class="action-step"><div class="action-label">ç¯å¢ƒé‡å¡‘</div><div class="action-content">ä½ çš„å…³é”®æ˜¯â€œå®‰å…¨æ„Ÿâ€ã€‚äº²çƒ­å‰ï¼Œè¯·å½“ç€ä½ çš„é¢é”å¥½é—¨ï¼ŒæŠŠæ‰‹æœºæ‰”åˆ°å®¢å…ã€‚åˆ›é€ ä¸€ä¸ªâ€œç»å¯¹ä¸ä¼šè¢«æ‰“æ‰°â€çš„çœŸç©ºç¯å¢ƒï¼Œè¿™å¯¹ä½ çš„å¤§è„‘è‡³å…³é‡è¦ã€‚</div></div>`;
        } else {
            actionHtml += `<div class="action-step"><div class="action-label">æ·±åº¦åŒæ­¥</div><div class="action-content">æ‰¾ä¸ªæ—¶é—´ï¼Œæ¡ç€ä»–çš„æ‰‹è¯´ï¼šâ€œæˆ‘æœ€è¿‘æ„Ÿè§‰æˆ‘ä»¬åƒå®¤å‹ï¼Œæˆ‘å¾ˆæ€€å¿µä»¥å‰ã€‚æˆ‘ä»¬å¯ä»¥ä»Šæ™šåªæ¥å»å—ï¼Ÿâ€</div></div>`;
        }
        document.getElementById('action-plan').innerHTML = actionHtml;
    }
</script>
</body>
</html>